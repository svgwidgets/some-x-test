<template>
  <g>
    <!-- Sensor box -->
    <rect
      :x="elements.box.x"
      :y="elements.box.y"
      :width="elements.box.width"
      :height="elements.box.height"
      rx="4"
      fill="white"
      stroke="#333"
      stroke-width="2"
      class="sensor-box"
    />
    
    <!-- Tag -->
    <text 
      :x="textPositions.tag.x" 
      :y="textPositions.tag.y" 
      text-anchor="middle" 
      font-size="12" 
      font-weight="bold" 
      fill="#666"
    >
      {{ tag }}
    </text>
    
    <!-- Value -->
    <text 
      :x="textPositions.value.x" 
      :y="textPositions.value.y" 
      text-anchor="middle" 
      font-size="16" 
      font-weight="bold" 
      :fill="valueColor"
    >
      {{ formattedValue }}
    </text>
    
    <!-- Unit -->
    <text 
      :x="textPositions.unit.x" 
      :y="textPositions.unit.y" 
      text-anchor="middle" 
      font-size="10" 
      fill="#999"
    >
      {{ io.unit }}
    </text>
    
    <!-- Label -->
    <text 
      v-if="showLabel"
      x="40" 
      y="-8" 
      text-anchor="middle" 
      font-size="10" 
      font-weight="bold" 
      fill="#333"
    >
      {{ io.id }}
    </text>
  </g>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import type { AnalogIO } from '../../io';
import { svgLibrary, getIOColor } from '../../visuals';

interface Props {
  io: AnalogIO;
  showLabel?: boolean;
  tag?: string;
}

const props = withDefaults(defineProps<Props>(), {
  showLabel: true,
});

const visual = computed(() => svgLibrary.get('temperature-sensor')!);
const elements = computed(() => visual.value.metadata?.elements || {});
const textPositions = computed(() => visual.value.metadata?.textPositions || {});
const defaultTag = computed(() => visual.value.metadata?.defaultTag || 'TT');

const tag = computed(() => props.tag || defaultTag.value);
const valueColor = computed(() => getIOColor(props.io));
const formattedValue = computed(() => props.io.value.toFixed(props.io.precision || 1));
</script>
