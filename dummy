<template>
  <g>
    <!-- Casing -->
    <circle
      :cx="elements.casing.cx"
      :cy="elements.casing.cy"
      :r="elements.casing.r"
      fill="none"
      stroke="#333"
      stroke-width="2"
      class="pump-casing"
    />
    
    <!-- Impeller (animated by AnimationController) -->
    <g 
      class="pump-impeller" 
      :transform-origin="impellerTransformOrigin"
    >
      <path
        v-for="(child, idx) in impellerChildren"
        :key="idx"
        :d="child.d"
        :fill="pumpColor"
      />
    </g>
    
    <!-- Ports -->
    <g v-if="showPorts">
      <circle 
        v-for="port in visual.ports"
        :key="port.id"
        :cx="port.position.x" 
        :cy="port.position.y" 
        r="4" 
        :fill="port.type === 'inlet' ? '#2196F3' : '#FF9800'" 
        stroke="#333" 
        stroke-width="1.5"
      />
    </g>
    
    <!-- Label -->
    <text 
      v-if="showLabel"
      :x="centerX" 
      y="-8" 
      text-anchor="middle" 
      font-size="10" 
      font-weight="bold" 
      fill="#333"
    >
      {{ io.id }}
    </text>
  </g>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import type { DigitalIO } from '../../io';
import { svgLibrary, getIOColor } from '../../visuals';

interface Props {
  io: DigitalIO;
  showPorts?: boolean;
  showLabel?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  showPorts: true,
  showLabel: true,
});

const visual = computed(() => svgLibrary.get('centrifugal-pump')!);
const elements = computed(() => visual.value.metadata?.elements || {});
const centerX = computed(() => visual.value.viewBox.width / 2);
const pumpColor = computed(() => getIOColor(props.io));

const impellerTransformOrigin = computed(() => {
  const impeller = elements.value.impeller as any;
  return impeller?.transformOrigin || '20 20';
});

const impellerChildren = computed(() => {
  const impeller = elements.value.impeller as any;
  return impeller?.children || [];
});
</script>
