<template>
  <g class="pipe-renderer">
    <!-- Main pipe line -->
    <line
      :x1="from.x"
      :y1="from.y"
      :x2="to.x"
      :y2="to.y"
      :stroke="pipeColor"
      stroke-width="3"
      class="pipe-line"
    />
    
    <!-- Flow dots (animated by AnimationController when flowing) -->
    <g v-if="flowing" class="flow-dots">
      <circle
        v-for="dot in flowDots"
        :key="dot.id"
        :r="3"
        fill="#2196F3"
        class="flow-dot"
      >
        <animateMotion
          :path="motionPath"
          :dur="`${duration}ms`"
          repeatCount="indefinite"
          :begin="`${dot.offset}ms`"
        />
      </circle>
    </g>
  </g>
</template>

<script setup lang="ts">
import { computed } from 'vue';

interface Props {
  from: { x: number; y: number };
  to: { x: number; y: number };
  flowing?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  flowing: false,
});

const pipeColor = computed(() => props.flowing ? '#1976D2' : '#666');
const duration = 2000;

const motionPath = computed(() => {
  return `M ${props.from.x} ${props.from.y} L ${props.to.x} ${props.to.y}`;
});

const flowDots = computed(() => [
  { id: 1, offset: 0 },
  { id: 2, offset: 500 },
  { id: 3, offset: 1000 },
  { id: 4, offset: 1500 },
]);
</script>

<style scoped>
.pipe-line {
  transition: stroke 0.3s ease;
}

.flow-dot {
  filter: drop-shadow(0 0 2px rgba(33, 150, 243, 0.8));
}
</style>
