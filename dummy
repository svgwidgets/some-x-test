<template>
  <g
    :ref="(el) => setComponentRef(el as SVGGElement)"
    class="animated-component"
  >
    <slot></slot>
  </g>
</template>

<script setup lang="ts">
import { ref, watch, onMounted, onUnmounted } from 'vue';
import type { IOComponent } from '../io/IOComponent';
import type { AnimationDefinition } from './AnimationDefinition';
import { animationController } from './AnimationController';

interface Props {
  io: IOComponent;
  animations: AnimationDefinition[];
}

const props = defineProps<Props>();

const componentRef = ref<SVGGElement | null>(null);

function setComponentRef(el: SVGGElement | null) {
  componentRef.value = el;
  if (el) {
    applyAnimations();
  }
}

// Apply animations when I/O value changes
watch(() => props.io.value, () => {
  applyAnimations();
}, { deep: true });

// Apply animations when animations array changes
watch(() => props.animations, () => {
  applyAnimations();
}, { deep: true });

function applyAnimations() {
  if (!componentRef.value) return;
  
  props.animations.forEach(animation => {
    const targetElement = componentRef.value!.querySelector(animation.target);
    
    if (targetElement) {
      animationController.applyAnimation(
        targetElement as SVGElement,
        animation,
        props.io
      );
    } else {
      console.warn(`[AnimatedComponent] Target element not found: ${animation.target}`);
    }
  });
}

onMounted(() => {
  applyAnimations();
});

onUnmounted(() => {
  // Cleanup if needed
});
</script>

<style scoped>
.animated-component {
  /* Base styles */
}
</style>
